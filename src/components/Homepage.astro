---
import { getPostsForHomepage } from '../lib.js'

import DateTime from './DateTime.astro'
import PostList from './PostList.astro'
import FormWeeklyNewsletter from './FormWeeklyNewsletter.astro'

const { posts: all, newsletters } = getPostsForHomepage(
  await Astro.glob('../pages/bai-viet/*.md'),
  await Astro.glob('../pages/ban-tin/*.md'),
)

const top3 = all.slice(0, 3)
const posts = all.slice(3)
---

<style>
  .top {
    display: grid;
    gap: 16px;
    @media (--lg) {
      grid-template-columns: 1fr 1fr;
    }
  }

  .newsletter {
    background-color: var(--gray-3);
    border-radius: 4px;
    padding: 16px;
    gap: 16px;
    display: flex;
    justify-content: center;
    flex-direction: column;

    @media (--lg) {
      grid-column: 1 / 3;
      grid-row: 1 / 4;
    }
  }

  .article {
    display: grid;
    gap: 16px;

    @media (--md) {
      grid-template-columns: 1fr 1fr;
    }

    @media (--lg) {
      grid-template-columns: 320px 320px;
    }

    @media (--lg) {
      &:nth-child(1) {
        grid-column-end: 1;
      }
      &:nth-child(2) {
        grid-row-start: 2;
      }
      &:nth-child(3) {
        grid-row-start: 3;
      }
    }
  }

  .newsletter-preview-list {
    margin-left: 16px;
    padding-right: 8px;
    list-style-type: 'üî∏';

    li {
      padding-left: 8px;
    }
  }
</style>

<div class="mb-4">
  <div class="top">
    {
      top3.map(({ frontmatter, url }) => (
        <article class="article">
          <img class="post-list-single-cover" src={frontmatter.cover} alt={frontmatter.title} />
          <div class="flex flex-column gap-1">
            <h3>
              <a class="no-underline-link" href={url}>
                {frontmatter.title}
              </a>
            </h3>
            <p>{frontmatter.excerpt}</p>
            <p class="text-gray-6 text-sm">
              @{frontmatter.author} | <DateTime date={frontmatter.date} />
            </p>
          </div>
        </article>
      ))
    }

    <div class="newsletter">
      <h3>B·∫£n tin Ehkoo</h3>
      <p>C·∫≠p nh·∫≠t nh·ªØng tin t·ª©c m·ªõi nh·∫•t v·ªÅ l·∫≠p tr√¨nh frontend, m·ªói s√°ng th·ª© 7 h√†ng tu·∫ßn.</p>

      <h4>Ngh√≠a qua th·ª≠ üëÄ</h4>
      <ul class="newsletter-preview-list">
        {
          newsletters.map(({ url, frontmatter }) => (
            <li>
              <a class="text-sm" href={url}>
                {frontmatter.title}
              </a>
            </li>
          ))
        }
      </ul>

      <h4>ƒêƒÉng k√Ω üëá</h4>

      <FormWeeklyNewsletter>
        <input type="hidden" name="metadata__FormLocation" value="Homepage" />
      </FormWeeklyNewsletter>
    </div>
  </div>
</div>

<div class="mb2">
  <PostList posts={newsletters} />
</div>

<div class="mb-2">
  <PostList posts={posts} />
</div>
<div class="text-center">
  <a href="/bai-viet">T·∫•t c·∫£ b√†i vi·∫øt</a>
</div>
