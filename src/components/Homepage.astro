---
import { getCollection } from 'astro:content'

import { getPostsForHomepage, getNewsletters, groupPostsByYear, resizePostCover } from '../lib'

import PostList from './post/PostList.astro'
import Newsletter from './newsletter/CallToAction.astro'
import TopPosts from './TopPosts.astro'
import LearnTypeScript from './LearnTypeScript.astro'

const TOP_POSTS = 3

const resizeCover = (post) => resizePostCover(post, { width: 400, height: 300 })
const posts = getPostsForHomepage(await getCollection('bai-viet'))
const top = posts.slice(0, TOP_POSTS).map(resizeCover)

const groups = groupPostsByYear(posts.slice(TOP_POSTS).map(resizeCover))
const sortedYears = Object.entries(groups).sort(([a], [b]) => Number(b) - Number(a))

const newsletters = getNewsletters(await getCollection('ban-tin')).map(resizeCover)
---

<style>
  .home {
    display: grid;
    gap: var(--size-4);
  }

  .box {
    background-color: var(--box-bg-color);
    border: var(--box-border);
  }

  .new-posts {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(35ch, 1fr));
    gap: var(--size-3);
  }

  .subgrid {
    display: grid;
    grid-template-columns: subgrid;
    gap: var(--size-3);
  }

  .welcome {
    padding-block-start: var(--size-3);
  }
</style>

<div class="home">
  <div class="flow box welcome">
    <h2>ChÃ o má»«ng báº¡n Ä‘áº¿n vá»›i Ehkoo ğŸ‘‹</h2>
    <p>
      BÃªn cáº¡nh nhá»¯ng chá»§ Ä‘á» thÆ°á»ng gáº·p nhÆ° <a href="/chu-de/css"><strong>HTML, CSS</strong></a> hay
      <a href="/chu-de/javascript"><strong>JavaScript</strong></a>, Ehkoo cÃ²n chia sáº» vá»›i báº¡n nhá»¯ng
      <a href="/chu-de/danh-cho-nguoi-moi"><strong>kinh nghiá»‡m</strong></a>
      cho ngÆ°á»i má»›i báº¯t Ä‘áº§u, sá»­ dá»¥ng <a href="/chu-de/git"><strong>git</strong></a>, hay trÃ¬nh soáº¡n tháº£o hiá»‡u quáº£ hÆ¡n ğŸ‘‰
      <a href="/chu-de"><strong>Xem táº¥t cáº£.</strong></a>
    </p>
  </div>

  <div class="box new-posts">
    <div class="subgrid">
      <h3>ğŸ—ï¸ Báº£n tin</h3>
      <!-- <TopPosts posts={newsletters} /> -->
    </div>

    <div class="subgrid">
      <h3>ğŸ“ BÃ i viáº¿t má»›i</h3>
      <!-- <TopPosts posts={top} /> -->
    </div>
  </div>

  <Newsletter posts={newsletters} />

  <!-- <LearnTypeScript /> -->

  <div class="flow box">
    <h2>Nhá»¯ng bÃ i khÃ¡c</h2>
    <!-- <PostList posts={sortedYears} /> -->
  </div>
</div>
