---
import DateTime from '../DateTime.astro'
---

<style>
  .latest {
    display: grid;
    gap: var(--size-3);

    @media (--md) {
      grid-template-columns: repeat(3, 1fr);
    }
  }

  .cover {
    border-radius: var(--radius-2);
  }

  .article {
    display: grid;
    gap: var(--size-3);
    align-items: center;
    grid-template-columns: var(--homepage-cover-size) 1fr;

    @media (--md) {
      gap: var(--size-2);
      justify-items: center;
      grid-template-columns: 1fr;
      align-content: center;
      align-content: first baseline;
    }
  }

  .title {
    font-size: var(--font-size-1);
    @media (--md) {
      display: none;
    }
  }

  .time {
    font-size: 0.9em;
    color: var(--text-secondary);
    text-transform: capitalize;
    font-weight: 300;
    display: flex;
    flex-direction: column;

    @media (--md) {
      align-items: center;
    }
  }

  .link {
    text-align: center;
    font-weight: 600;

    @media (--lg) {
      text-align: left;
    }
  }
</style>

<div class="latest">
  {
    Astro.props.posts.map(({ frontmatter, url }) => (
      <article class="article">
        <a href={url}>
          <img class="cover" src={frontmatter.cover} alt={frontmatter.title} loading="lazy" decoding="async" />
        </a>
        <div>
          <a href={url} class="no-underline-link">
            <h3 class="title">{frontmatter.title}</h3>
          </a>

          <DateTime date={frontmatter.date} className="time js-newletter-date" />
        </div>
      </article>
    ))
  }
</div>

<p class="link">ðŸ‘‰ <a href="/chu-de/newsletter">Xem báº£n tin cÅ© hÆ¡n</a></p>

<script>
  import { timeAgo } from '../../lib/date-time'

  const dateEls = document.querySelectorAll('time.js-newletter-date')

  for (const node of dateEls) {
    const date = new Date(node.getAttribute('datetime'))
    console.log(timeAgo(date))

    const newNode = document.createElement('small')
    newNode.textContent = `(${timeAgo(date)})`

    node.appendChild(newNode)
  }
</script>
