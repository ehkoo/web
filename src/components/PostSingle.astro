---
import {Markdown} from '@astropub/md'
import PostMeta from './PostMeta.astro'
import PostNav from './post/PostNav.astro'
import FormNewsletter from './newsletter/Form.astro'

import s from './PostSingle.module.css'
import BuyMeACoffee from './BuyMeACoffee.astro'

const {
  headers,
  post: { title, isPage },
} = Astro.props
---

<style>
  .box {
    background-color: var(--surface-2);
    padding: var(--size-3);
    border-radius: var(--radius-2);
    border: 2px solid var(--text-primary);
  }
</style>

<article id="post" class:list={['flow', s.post]}>
  <h1 class={s.title}>
    <Markdown.Inline of={title} />
  </h1>

  {
    !isPage && (
      <>
        <PostMeta post={Astro.props.post} />
        <PostNav headers={headers} />
      </>
    )
  }

  <div class={s.wrapper}>
    <div class="flow">
      <div class={s.content} id="js-content">
        <slot />
      </div>

      {
        !isPage && (
          <>
            <div class="flow box" id="js-newsletterbox">
              <h3>B·∫£n tin Ehkoo h√†ng tu·∫ßn üíå</h3>

              <p>
                ƒêƒÉng k√Ω ngay ƒë·ªÉ nh·∫≠n nh·ªØng tin v√† b√†i vi·∫øt m·ªõi nh·∫•t v·ªÅ l·∫≠p tr√¨nh frontend, c≈©ng nh∆∞ c√°c th·ªß thu·∫≠t hay
                th∆∞ vi·ªán m·ªõi‚Ä¶
              </p>

              <FormNewsletter>
                <input type="hidden" name="metadata__FormLocation" value="SinglePost" />
              </FormNewsletter>
            </div>

            <BuyMeACoffee />

            <script>
              const content = document.getElementById('js-content');
              const newsletter = document.getElementById('js-newsletterbox');
              const headings = content.querySelectorAll('h1, h2, h3, h4')

              // Move the newsletter box before the middle node in `content`
              if (headings.length > 0) {
                const middle = headings[Math.round(headings.length / 2)];
                if (middle) content.insertBefore(newsletter, middle);
              }
            </script>

            <div id="comments">
              <script
                is:inline
                src="https://utteranc.es/client.js"
                repo="ehkoo/web"
                issue-term="pathname"
                label="web-comments"
                theme="github-light"
                crossorigin="anonymous"
                async
              />
            </div>
          </>
        )
      }
    </div>
  </div>
</article>
